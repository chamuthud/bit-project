<h2>Register</h2>
<form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
  <div class="form-group">
    <label for="username">Username *</label>
    <input type="text" id="username" formControlName="username" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && username?.invalid }">
    <div *ngIf="submitted && username?.invalid" class="invalid-feedback">
      <div *ngIf="username?.errors?.['required']">Username is required</div>
      <div *ngIf="username?.errors?.['minlength']">Username must be at least 3 characters</div>
      <div *ngIf="username?.errors?.['maxlength']">Username must be at most 50 characters</div>
    </div>
  </div>

  <div class="form-group">
    <label for="email">Email *</label>
    <input type="email" id="email" formControlName="email" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && email?.invalid }">
    <div *ngIf="submitted && email?.invalid" class="invalid-feedback">
      <div *ngIf="email?.errors?.['required']">Email is required</div>
      <div *ngIf="email?.errors?.['email']">Invalid email format</div>
       <div *ngIf="email?.errors?.['maxlength']">Email must be at most 100 characters</div>
    </div>
  </div>

  <div class="form-group">
    <label for="password">Password *</label>
    <input type="password" id="password" formControlName="password" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && password?.invalid }">
    <div *ngIf="submitted && password?.invalid" class="invalid-feedback">
      <div *ngIf="password?.errors?.['required']">Password is required</div>
      <div *ngIf="password?.errors?.['minlength']">Password must be at least 6 characters</div>
       <div *ngIf="password?.errors?.['maxlength']">Password must be at most 120 characters</div>
    </div>
  </div>

  <div class="form-group">
    <label for="firstName">First Name *</label>
    <input type="text" id="firstName" formControlName="firstName" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && firstName?.invalid }">
    <div *ngIf="submitted && firstName?.invalid" class="invalid-feedback">
      <div *ngIf="firstName?.errors?.['required']">First Name is required</div>
      <div *ngIf="firstName?.errors?.['maxlength']">First Name must be at most 50 characters</div>
    </div>
  </div>

   <div class="form-group">
    <label for="lastName">Last Name *</label>
    <input type="text" id="lastName" formControlName="lastName" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && lastName?.invalid }">
    <div *ngIf="submitted && lastName?.invalid" class="invalid-feedback">
      <div *ngIf="lastName?.errors?.['required']">Last Name is required</div>
       <div *ngIf="lastName?.errors?.['maxlength']">Last Name must be at most 50 characters</div>
    </div>
  </div>

   <div class="form-group">
    <label for="nic">NIC</label>
    <input type="text" id="nic" formControlName="nic" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && registerForm.get('nic')?.invalid }">
     <div *ngIf="submitted && registerForm.get('nic')?.invalid" class="invalid-feedback">
       <div *ngIf="registerForm.get('nic')?.errors?.['maxlength']">NIC must be at most 15 characters</div>
    </div>
  </div>

   <div class="form-group">
    <label for="mobile">Mobile</label>
    <input type="text" id="mobile" formControlName="mobile" class="form-control"
           [ngClass]="{ 'is-invalid': submitted && registerForm.get('mobile')?.invalid }">
     <div *ngIf="submitted && registerForm.get('mobile')?.invalid" class="invalid-feedback">
       <div *ngIf="registerForm.get('mobile')?.errors?.['maxlength']">Mobile must be at most 20 characters</div>
    </div>
  </div>

   <div class="form-group">
    <label for="address">Address</label>
    <textarea id="address" formControlName="address" class="form-control"></textarea>
  </div>

  <div class="form-group">
    <label for="role">Register As *</label>
    <select id="role" formControlName="role" class="form-select" [ngClass]="{ 'is-invalid': submitted && role?.invalid }">
      <option value="" disabled>Select a role...</option>
      <option value="client">Client</option>
      <option value="contractor">Contractor</option>
      <option value="vendor">Vendor</option>
    </select>
    <div *ngIf="submitted && role?.invalid" class="invalid-feedback">
      <div *ngIf="role?.errors?.['required']">Please select a role</div>
    </div>
  </div>
  <div class="form-group">
    <button type="submit" class="btn btn-primary" [disabled]="registerForm.invalid || isLoading">
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
     {{ isLoading ? 'Registering...' : 'Register' }}
   </button>
  </div>

  <div *ngIf="isSignUpFailed" class="alert alert-danger mt-3">
    Registration failed: {{ errorMessage }}
  </div>

  <div *ngIf="isSuccessful" class="alert alert-success mt-3">
    Registration successful! You can now <a routerLink="/auth/login">login</a>.
  </div>

   <div class="mt-3">
    Already have an account? <a routerLink="/auth/login">Login here</a>
  </div>
</form>